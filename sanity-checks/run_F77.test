#!/bin/sh

# Testsuite sanity check: check the `run_F77' subroutine.

. ../lib/rat4-t.sh || exit 99

require_fortran_compiler

# -*-*-

cat >true.f <<\EOF
      program true
        call halt
      end
EOF

cat true.f

run_F77 true.f || testcase_FATAL_FAILURE
test -f true.exe && test -x true.exe || {
    ls -l true.exe || :
    testcase_FATAL_FAILURE
}

run_command ./true.exe
test -s stdout && testcase_FATAL_FAILURE
test -s stderr && testcase_FATAL_FAILURE

# -*-*-

cat >main.f <<\EOF
      program hw
        call hello('World')
        call halt
      end
EOF

cat >hello.f <<\EOF
      subroutine hello(s)
        character s*(*)
        write(*,100) s
100     format('Hello, ', A, '!')
        return
      end
EOF

cat main.f
cat hello.f

run_F77 -o hw.exe hello.f main.f || testcase_FATAL_FAILURE
test -f hw.exe && test -x hw.exe || {
    ls -l hw.exe || :
    testcase_FATAL_FAILURE
}

run_command ./hw.exe
test -s stderr && testcase_FATAL_FAILURE
mv stdout got

echo 'Hello, World!' >exp

cat exp
cat got

$DIFF_U exp got || testcase_FATAL_FAILURE

# -*-*-

testcase_PASS

# vim: ft=sh ts=4 sw=4 et
