#!/bin/sh

# Check that nested `include' works.

. ./TestsAux/defs.sh || exit 99

cat >tst1.r <<EOF
define L0 L1
define L1 L2
:L0:
define L1 L3
:L0:
EOF

cat >exp1 <<EOF
:L2:
:L3:
EOF

run_RATFOR tst1.r || testcase_FAIL
$GREP -v '^[cC]' stdout | ws_normalize > got1
rm -f stdout

cat exp1
cat got1

$DIFF_U exp1 got1 || testcase_FAIL

# the same test as above, with deeper nesting

cat >tst2.r <<EOF
define L0 L1
define L1 L2
define L2 L3
define L3 L4
define L4 L5
define L5 L6
define L6 L7
define L7 L8
define L8 L9
:L0:
define L9 foo
:L0:
define L9 bar
:L0:
define bar quux
:L0:
EOF

cat >exp2 <<EOF
:L9:
:foo:
:bar:
:quux:
EOF

run_RATFOR tst2.r || testcase_FAIL
$GREP -v '^[cC]' stdout | ws_normalize > got2
rm -f stdout

cat exp2
cat got2

$DIFF_U exp2 got2 || testcase_FAIL

testcase_PASS

# vim: ft=sh ts=4 sw=4 et
