#!/bin/sh

# Check use of `define' with macros having underscores in names.

. ./defs.sh || exit 99

cat >tst.r <<EOF
define sym1     text
define sym_1    t_e_x_t

define _        underscore
define __       doubleunderscore

define foo      x0
define fo_o     x1
define fo_o     x2
define f_o_o    x3
define f__o_o   x4
define f__o__o  x5
define _foo     x6
define __foo    x7
define foo_     x8
define foo__    x9

sym1
sym_1

_
__

foo
fo_o
fo_o
f_o_o
f__o_o
f__o__o
_foo
__foo
foo_
foo__
EOF

cat >exp <<EOF
text
t_e_x_t
underscore
doubleunderscore
x0
x1
x2
x3
x4
x5
x6
x7
x8
x9
EOF

cat tst.r

run_CMD "$RATFOR" tst.r || testcase_FAIL
test -s stderr && testcase_FAIL

$SED -e '/^[cC]/d' -e "s/^$ws0p//" -e '/^$/d' stdout >got

cat exp
cat got

$DIFF_U exp got || testcase_FAIL

testcase_PASS

# vim: ft=sh ts=4 sw=4 et
