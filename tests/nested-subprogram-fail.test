#!/bin/sh

# Check that ratfor complains if nested subprograms (a.k.a. functions or
# subroutines) are found.

. ../lib/rat4-t.sh || exit 99

cat >tst1.r <<EOF
function f1
function f2
EOF

cat >tst2.r <<EOF
function f
subroutine s
EOF

cat >tst3.r <<EOF
subroutine s
function f
EOF

cat >tst4.r <<EOF
subroutine s1
subroutine s2
EOF

cat tst1.r
cat tst2.r
cat tst3.r
cat tst4.r

run_RATFOR -e 1 tst1.r || testcase_FAIL
mv stderr stderr1
$FGREP 'function defined into function body' stderr1 || testcase_FAIL

run_RATFOR -e 1 tst2.r || testcase_FAIL
mv stderr stderr2
$FGREP 'subroutine defined into function body' stderr2 || testcase_FAIL

run_RATFOR -e 1 tst3.r || testcase_FAIL
mv stderr stderr3
$FGREP 'function defined into subroutine body' stderr3 || testcase_FAIL

run_RATFOR -e 1 tst4.r || testcase_FAIL
mv stderr stderr4
$FGREP 'subroutine defined into subroutine body' stderr4 || testcase_FAIL

testcase_DONE

# vim: ft=sh ts=4 sw=4 et
