#!/bin/sh

# Check that ratfor generate correct code for a `return' statement.

. ../lib/rat4-t.sh || exit 99


tr '^' ' ' > tst.r <<EOF
function f1
    return 1+1
end

function f2()
    return 2-2
end

function f3(x)
    return (3^+^^^3)
end

function f4; return(4^^-^4); end
EOF

cat tst.r

run_RATFOR tst.r || testcase_FATAL_FAILURE
$GREP "^ *return *$" stdout || testcase_FATAL_FAILURE
test `$GREP "^ *return *$" stdout | wc -l` -eq 4 || testcase_FATAL_FAILURE
$GREP "[^ ].*return" stdout && testcase_FATAL_FAILURE
$GREP "return.*[^ ]" stdout && testcase_FATAL_FAILURE
$GREP "^ *f1 *= *1+1 *$" stdout || testcase_FATAL_FAILURE
$GREP "^ *f2 *= *2-2 *$" stdout || testcase_FATAL_FAILURE
$GREP "^ *f3 *= *(3 + 3) *$" stdout || testcase_FATAL_FAILURE
$GREP "^ *f4 *= *(4 - 4) *$" stdout || testcase_FATAL_FAILURE

testcase_DONE

# vim: ft=sh ts=4 sw=4 et
