#!/bin/sh

# Check (with f77) that processing of `return' keyword works also for
# convoluted usages.

. ../lib/rat4-t.sh || exit 99

require_fortran_compiler

cat >tst.r <<\EOF
    real function rfunc1()
        return 2.0
    end
    integer function ifunc2(i, j)
        integer i, j
        ifunc2 = i + j
        return
    end
    subroutine bar()
        write(*,10); 10 format('bar ok');
        return
        write(*,20); 20 format('EPIC FAIL');
    end
    program returnstress
        write(*,100) rfunc1()
        write(*,200) ifunc2(1,2)
        write(*,200) ifunc2(3,4)
100     format(F3.1)
200     format(I1)
        call bar
        call halt
    end
EOF


cat > exp <<EOF
2.0
3
7
bar ok
EOF

run_RATFOR tst.r || testcase_FATAL_FAILURE
mv stdout tst.f
run_F77 tst.f || testcase_FATAL_FAILURE
run_command ./tst.exe || testcase_FATAL_FAILURE
mv stdout got
test -s stderr && testcase_FATAL_FAILURE
$DIFF_U exp got || testcase_FATAL_FAILURE

testcase_PASS

# vim: ft=sh ts=4 sw=4 et
