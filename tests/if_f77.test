#!/bin/sh

# Test the `if' statement (by compiling and running the generated
# fortran code)

. ../lib/rat4-t.sh || exit 99

require_fortran_compiler

OK='write(*,100)'
BAD='write(*,200)'
cat > tst.r <<EOF
program testif

    if(1==1)
        $OK 1
    if (0 == 1)
        $BAD 2

    if(0==1)
        $BAD 3
    else
        $OK 4

    if (1 == 1)
        $OK 5
    else
        $BAD 6

    call halt

100 format('ok ',I1)
200 format('bad ', I1)
end
EOF

cat > exp <<EOF
ok 1
ok 4
ok 5
EOF

cat tst.r

run_RATFOR tst.r || testcase_FATAL_FAILURE
mv stdout tst.f
run_F77 tst.f || testcase_FATAL_FAILURE
run_command ./tst.exe || testcase_FATAL_FAILURE
mv stdout got

cat exp
cat got

test -s stderr && testcase_FATAL_FAILURE
$DIFF_U exp got || testcase_FATAL_FAILURE

testcase_DONE

# vim: ft=sh ts=4 sw=4 et
