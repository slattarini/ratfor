#!/bin/sh

# Check that ratfor continue its execution on non-fatal syntax errors.

. ../lib/rat4-t.sh || exit 99

require_fortran_compiler

cat > tst.r <<EOF
program testprogram
    write(*,100) "ALIVE"
    } # syntax error here
100 format(A5)
    next # syntax error here
    call halt
end # testprogram
EOF

echo 'ALIVE' > exp

run_RATFOR -e 1 tst.r || testcase_FATAL_FAILURE
$FGREP 'illegal right brace' stderr || testcase_FATAL_FAILURE
$FGREP 'illegal next' stderr || testcase_FATAL_FAILURE
mv stdout tst.f

run_F77 tst.f || testcase_FATAL_FAILURE
run_command ./tst.exe || testcase_FATAL_FAILURE
mv stdout got
test -s stderr && testcase_FATAL_FAILURE

cat exp
cat got

$DIFF_U exp got || testcase_FATAL_FAILURE

testcase_PASS

# vim: ft=sh ts=4 sw=4 et
