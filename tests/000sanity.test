#!/bin/sh

# Check that there are no obvious errors in the testing framework.

. ./defs.sh || exit 99

test_func() {
    cat <<EOF
OUT${1-}
EOF
    echo "ERR${1-}" >&2
}
run_CMD test_func 1 || testcase_FAIL
test -f stdout || testcase_FAIL
test -f stderr || testcase_FAIL
test x"`cat stdout`" = x"OUT1" || testcase_FAIL
test x"`cat stderr`" = x"ERR1" || testcase_FAIL

run_CMD -e 0 test_func 2 || testcase_FAIL
test -f stdout || testcase_FAIL
test -f stderr || testcase_FAIL
test x"`cat stdout`" = x"OUT2" || testcase_FAIL
test x"`cat stderr`" = x"ERR2" || testcase_FAIL

run_CMD -e 0 eval 'echo OUT3 && echo ERR3 >&2 && :' || testcase_FAIL
test -f stdout || testcase_FAIL
test -f stderr || testcase_FAIL
test x"`cat stdout`" = x"OUT3" || testcase_FAIL
test x"`cat stderr`" = x"ERR3" || testcase_FAIL

# TODO add a check on `timer' too

testcase_PASS

# vim: ft=sh ts=4 sw=4 et
