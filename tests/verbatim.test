#!/bin/sh

# Check the use of `%' to output lines verbatim

. ../lib/rat4-t.sh || exit 99

vtext="{|| bar VeRbAtIm $TAB &&}"
vtext2="define foo bar; $vtext"

echo "$vtext" >tst1.r
echo "%$vtext" >tst2.r
echo "foo; %$vtext" >tst3.r
echo "define bar quux; %$vtext" >tst4.r
(echo "%$vtext2"; echo "foo is safe") >tst5.r

run_RATFOR tst1.r || testcase_FAIL
$GREP "$vtext" stdout && testcase_FAIL

run_RATFOR tst2.r || testcase_FAIL
$GREP "^$vtext$" stdout || testcase_FAIL

run_RATFOR tst3.r || testcase_FAIL
$GREP "^$vtext$" stdout || testcase_FAIL

run_RATFOR tst4.r || testcase_FAIL
$GREP "^$vtext$" stdout || testcase_FAIL

run_RATFOR tst5.r || testcase_FAIL
$GREP "^$vtext2$" stdout || testcase_FAIL
$GREP "foo is safe" stdout || testcase_FAIL

testcase_DONE

# vim: ft=sh ts=4 sw=4 et
