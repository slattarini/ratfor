#!/bin/sh

# Check the use of `%' to output lines verbatim

. ../lib/rat4-t.sh || exit 99

vtext="{|| bar VeRbAtIm $TAB &&}"
vtext2="define foo bar; $vtext"

echo "$vtext" >tst1.r
echo "%$vtext" >tst2.r
echo "foo; %$vtext" >tst3.r
echo "define bar quux; %$vtext" >tst4.r
(echo "%$vtext2"; echo "foo is safe") >tst5.r

run_RATFOR tst1.r || testcase_FATAL_FAILURE
mv stdout stdout1
$GREP "$vtext" stdout1 && testcase_FATAL_FAILURE

run_RATFOR tst2.r || testcase_FATAL_FAILURE
mv stdout stdout3
$GREP "^$vtext$" stdout3 || testcase_FATAL_FAILURE

run_RATFOR tst4.r || testcase_FATAL_FAILURE
mv stdout stdout4
$GREP "^$vtext$" stdout4 || testcase_FATAL_FAILURE

run_RATFOR tst5.r || testcase_FATAL_FAILURE
mv stdout stdout5
$GREP "^$vtext2$" stdout5 || testcase_FATAL_FAILURE
$GREP "foo is safe" stdout5 || testcase_FATAL_FAILURE

testcase_PASS

# vim: ft=sh ts=4 sw=4 et
