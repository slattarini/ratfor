#!/bin/sh

# Check that an `else' statement is always paired with the last "opened"
# `if' statement (checks by compiling and running the generated fortran
# code)

. ../lib/rat4-testsuite-init.sh || exit 99

require_fortran_compiler

OK='write(*,100)'
BAD='write(*,200)'

cat > tst.r <<EOF
program testifelseamb
    if (1 == 0)
        if (1 == 1)
            $BAD 1
        else
            $BAD 2

    if (1 == 0) {
        if (1 == 1)
            $BAD 3
    } else
        $OK 4

    if (1 == 0)
        if (1 == 1)
            $BAD 5
        else
            $BAD 6
    else
        $OK 7

    call halt

100 format('ok ',I1)
200 format('bad ', I1)
end
EOF

cat > exp <<EOF
ok 4
ok 7
EOF

cat tst.r

run_RATFOR tst.r || testcase_FAIL
mv stdout tst.f
run_F77 tst.f || testcase_FAIL
run_command ./tst.exe || testcase_FAIL
test -s stderr && testcase_FAIL
mv stdout got

cat exp
cat got

$DIFF_U exp got || testcase_FAIL

testcase_DONE

# vim: ft=sh ts=4 sw=4 et
