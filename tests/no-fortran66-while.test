#!/bin/sh

# Check that the while clause d not generate improper code
# (Fortran 66 style).

. ../lib/rat4-t.sh || exit 99

cat > tst.r <<EOF
while (false)
    zap()
EOF
cat tst.r

run_RATFOR tst.r || testcase_FAIL
grep -v '^[cC]' stdout >stdout-t
mv stdout-t stdout

$FGREP 'goto'  stdout || testcase_FAIL
$FGREP 'then'  stdout || testcase_FAIL
$FGREP 'endif' stdout || testcase_FAIL

test `$FGREP 'then'  stdout | wc -l` -eq 1 || testcase_FAIL
test `$FGREP 'endif' stdout | wc -l` -eq 1 || testcase_FAIL
test `$FGREP 'goto'  stdout | wc -l` -eq 1 || testcase_FAIL

test `$GREP '^ *[0-9]' stdout | $GREP -v '^ *2300[01] ' | wc -l` -eq 0 \
  || testcase_FAIL 'Too many labels in generated fortran code'

testcase_DONE

# vim: ft=sh ts=4 sw=4 et
