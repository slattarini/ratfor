#!/bin/sh

# Check (with f77) that `define(SYM, VALUE)' works on multi-line VALUE.

. ../lib/rat4-t.sh || exit 99

require_fortran_compiler

cat >tst.r <<EOF
define(cmd,
    x = 1
    y = 2
    z = 3
100 format(I1))

    program testprogram
        implicit none
        integer x, y, z
        cmd
        write(*,100) x
        write(*,100) y
        write(*,100) z
        call halt
    end # testprogram
EOF

cat > exp <<EOF
1
2
3
EOF

run_RATFOR tst.r || testcase_FATAL_FAILURE
mv stdout tst.f
run_F77 tst.f || testcase_FATAL_FAILURE
run_command ./tst.exe || testcase_FATAL_FAILURE
test -s stderr && testcase_FATAL_FAILURE
mv stdout got

cat exp
cat got

$DIFF_U exp got || testcase_FATAL_FAILURE

testcase_DONE

# vim: ft=sh ts=4 sw=4 et
