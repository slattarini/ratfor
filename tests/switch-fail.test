#!/bin/sh

# Check that incorrect usages of the `switch/case' statement are caught
# (well, do not check here about missing `{' after `switch').

. ./TestsAux/defs.sh || exit 99

cat > tst.dat <<EOF
case 1          |   illegal case or default
;
case 1: pass    |   illegal case or default
;
default         |   illegal case or default
;
default:        |   illegal case or default
;
switch(1) {
    case:       |   invalid case label
}
switch(1) {
    case x:     |   invalid case label
}
switch(1) {
    case;       |   invalid case label
 
}
switch(1) {
    case (1):   |   invalid case label
}
switch(1) {
    case 1:
        pass
    case 1:     |   duplicated case label
        pass
}
switch(1) {
    case 0, 1:
        pass
    case 1, 2:  |   duplicated case label
        pass
}
EOF

$AWK '{ printf("%02d: %s\n", NR, $0) }' tst.dat

$SED -e 's/ *|.*$//' <tst.dat >tst.r
$AWK -F '|' '($2 != "") { print "tst.r:" NR ": " $2 }' <tst.dat \
  | $SED -e "s/$ws0p:$ws1p/: /" -e "s/$ws0p$/./" >exp

cat tst.r

run_command -e 1 "$RATFOR" tst.r || testcase_FAIL
mv stderr got

cat exp
cat got

$DIFF_U exp got || testcase_FAIL

testcase_PASS

# vim: ft=sh ts=4 sw=4 et
