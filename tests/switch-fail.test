#!/bin/sh

# Check that incorrect usages of the `case'/`default' inside a `switch'
# are caught.

# TODO: divide into two distinct tests

. ./TestsAux/rat4-t.sh || exit 99

: ::::::::::::::::: :
:  WRITE TEST DATA  :
: ::::::::::::::::: :

n=0
for case_ in 'case:' 'case x:' 'case;' 'case (1):' 'case /:'; do
  n=`expr $n + 1`
  cat > tst$n.r <<EOF
switch(1) {
    $case_
}
EOF
done

cat >tst-dup1.r <<EOF
switch(1) {
    case 1: pass
    case 1: pass
}
EOF

cat >tst-dup2.r <<EOF
switch(1) {
    case 0, 1: pass
    case 1, 2: pass
}
EOF

: :::::::::: :
:  DO TESTS  :
: :::::::::: :

i=1
while test $i -le $n; do
  i=`expr $i + 1`
  cat tst$n.r
  run_RATFOR -e 1 tst$i.r || testcase_REGISTER_FAILURE
  mv stdout stdout$i
  mv stderr stderr$i
  $EGREP "^tst$i\.r:2: (invalid case label|illegal case syntax)" stderr$i \
    || testcase_REGISTER_FAILURE
done

for i in 1 2; do
  cat tst-dup$i.r
  run_RATFOR -e 1 tst-dup$i.r || testcase_REGISTER_FAILURE
  mv stdout stdout-dup$i
  mv stderr stderr-dup$i
  $EGREP "^tst-dup$i\.r:3: duplicated case label" stderr-dup$i \
    || testcase_REGISTER_FAILURE
done

testcase_DONE

# vim: ft=sh ts=4 sw=4 et
